<div class="suppliers-container fade-in">
    <!-- Header -->
    <div class="header">
        <h1>{{ 'SUPPLIERS.TITLE' | translate }}</h1>
        <button class="btn-primary" (click)="openCreateForm()" *ngIf="!showForm">
            <i class="fas fa-plus"></i>
            {{ 'SUPPLIERS.NEW_SUPPLIER' | translate }}
        </button>
    </div>

    <!-- Search -->
    <div class="search-container" *ngIf="!showForm">
        <input type="search" [(ngModel)]="searchTerm" (input)="onSearch()" [placeholder]="'COMMON.SEARCH' | translate"
            class="search-input" />
    </div>

    <!-- Form (Create/Edit) -->
    <div *ngIf="showForm" class="min-h-[600px] flex justify-center fade-in pb-12">
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 w-full max-w-4xl overflow-hidden">

            <!-- Header -->
            <div class="px-8 py-6 border-b border-gray-100 flex items-center justify-between bg-white">
                <div>
                    <h2 class="text-xl font-bold text-gray-900">{{ formTitle | translate }}</h2>
                    <p class="text-gray-500 text-sm mt-1">Complete la información para registrar un nuevo socio
                        comercial.</p>
                </div>
                <button
                    class="w-8 h-8 rounded-full flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-colors"
                    (click)="closeForm()">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>

            <!-- Body -->
            <div class="p-8 bg-gray-50/30">
                <form (ngSubmit)="onSubmit()">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                        <!-- Name -->
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">
                                {{ 'SUPPLIERS.NAME' | translate }} <span class="text-red-500">*</span>
                            </label>
                            <div class="relative group">
                                <div
                                    class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400 group-focus-within:text-blue-500 transition-colors">
                                    <i class="far fa-building"></i>
                                </div>
                                <input type="text" [(ngModel)]="currentSupplier.name" name="name" required
                                    class="w-full pl-11 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all text-gray-900 placeholder-gray-400 outline-none hover:border-gray-300"
                                    placeholder="Ej. Tech Solutions S.L." />
                            </div>
                        </div>

                        <!-- Contact Person -->
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">
                                {{ 'SUPPLIERS.CONTACT_PERSON' | translate }}
                            </label>
                            <div class="relative group">
                                <div
                                    class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400 group-focus-within:text-blue-500 transition-colors">
                                    <i class="far fa-user"></i>
                                </div>
                                <input type="text" [(ngModel)]="currentSupplier.contact_person" name="contact_person"
                                    class="w-full pl-11 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all text-gray-900 placeholder-gray-400 outline-none hover:border-gray-300"
                                    placeholder="Ej. Juan Pérez" />
                            </div>
                        </div>

                        <!-- Email -->
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">
                                {{ 'SUPPLIERS.EMAIL' | translate }}
                            </label>
                            <div class="relative group">
                                <div
                                    class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400 group-focus-within:text-blue-500 transition-colors">
                                    <i class="far fa-envelope"></i>
                                </div>
                                <input type="email" [(ngModel)]="currentSupplier.email" name="email"
                                    class="w-full pl-11 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all text-gray-900 placeholder-gray-400 outline-none hover:border-gray-300"
                                    placeholder="contacto@empresa.com" />
                            </div>
                        </div>

                        <!-- Phone -->
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">
                                {{ 'SUPPLIERS.PHONE' | translate }}
                            </label>
                            <div class="relative group">
                                <div
                                    class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400 group-focus-within:text-blue-500 transition-colors">
                                    <i class="fas fa-phone-alt"></i>
                                </div>
                                <input type="tel" [(ngModel)]="currentSupplier.phone" name="phone"
                                    class="w-full pl-11 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all text-gray-900 placeholder-gray-400 outline-none hover:border-gray-300"
                                    placeholder="+34 600 000 000" />
                            </div>
                        </div>

                        <!-- Address -->
                        <div class="col-span-1 md:col-span-2 space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">
                                {{ 'SUPPLIERS.ADDRESS' | translate }}
                            </label>
                            <div class="relative group">
                                <div
                                    class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400 group-focus-within:text-blue-500 transition-colors">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <input type="text" [(ngModel)]="currentSupplier.address" name="address"
                                    class="w-full pl-11 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all text-gray-900 placeholder-gray-400 outline-none hover:border-gray-300"
                                    placeholder="Calle Principal 123, Oficina 4B, Madrid" />
                            </div>
                        </div>

                        <!-- Website -->
                        <div class="col-span-1 md:col-span-2 space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">
                                {{ 'SUPPLIERS.WEBSITE' | translate }}
                            </label>
                            <div class="relative group">
                                <div
                                    class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400 group-focus-within:text-blue-500 transition-colors">
                                    <i class="fas fa-globe"></i>
                                </div>
                                <input type="url" [(ngModel)]="currentSupplier.website" name="website"
                                    class="w-full pl-11 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all text-gray-900 placeholder-gray-400 outline-none hover:border-gray-300"
                                    placeholder="https://www.ejemplo.com" />
                            </div>
                        </div>

                        <!-- Notes -->
                        <div class="col-span-1 md:col-span-2 space-y-2">
                            <label class="block text-sm font-semibold text-gray-700">
                                {{ 'SUPPLIERS.NOTES' | translate }}
                            </label>
                            <textarea [(ngModel)]="currentSupplier.notes" name="notes" rows="4"
                                class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all text-gray-900 placeholder-gray-400 outline-none hover:border-gray-300 resize-none"
                                placeholder="Agregue detalles sobre términos de pago, horarios de entrega, etc."></textarea>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="mt-8 flex items-center justify-end gap-3 pt-6 border-t border-gray-100">
                        <button type="button" (click)="closeForm()"
                            class="px-6 py-2.5 bg-white border border-gray-300 text-gray-700 font-medium rounded-xl hover:bg-gray-50 transition-colors focus:ring-4 focus:ring-gray-100">
                            {{ 'COMMON.CANCEL' | translate }}
                        </button>
                        <button type="submit" [disabled]="isSubmitting"
                            class="px-8 py-2.5 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 shadow-md shadow-blue-200 transition-all focus:ring-4 focus:ring-blue-100 disabled:opacity-50 disabled:shadow-none flex items-center">
                            <span *ngIf="isSubmitting"><i class="fas fa-spinner fa-spin mr-2"></i></span>
                            <span>{{ (isSubmitting ? 'COMMON.SAVING' : (currentSupplier.id ? 'COMMON.UPDATE' :
                                'Sup.Nuevo' )) | translate }}</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading && !showForm" class="loading">
        <div class="spinner"></div>
        <p>{{ 'COMMON.LOADING' | translate }}...</p>
    </div>

    <!-- Table -->
    <div *ngIf="!isLoading && !showForm" class="table-container">
        <table>
            <thead>
                <tr>
                    <th>{{ 'SUPPLIERS.NAME' | translate }}</th>
                    <th>{{ 'SUPPLIERS.CONTACT_PERSON' | translate }}</th>
                    <th>{{ 'SUPPLIERS.EMAIL' | translate }}</th>
                    <th>{{ 'SUPPLIERS.PHONE' | translate }}</th>
                    <th>{{ 'SUPPLIERS.PRODUCTS_COUNT' | translate }}</th>
                    <th>{{ 'COMMON.ACTIONS' | translate }}</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let supplier of suppliers">
                    <td class="supplier-name">{{ supplier.name }}</td>
                    <td>{{ supplier.contact_person || '-' }}</td>
                    <td>{{ supplier.email || '-' }}</td>
                    <td>{{ supplier.phone || '-' }}</td>
                    <td class="text-center">
                        <span class="badge">{{ supplier._count?.products || 0 }}</span>
                    </td>
                    <td>
                        <div class="actions">
                            <button class="btn-icon" (click)="openEditForm(supplier)" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-danger" (click)="deleteSupplier(supplier)" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Empty state -->
        <div *ngIf="suppliers.length === 0" class="empty-state">
            <i class="fas fa-truck"></i>
            <p>{{ 'SUPPLIERS.NO_SUPPLIERS' | translate }}</p>
        </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="!isLoading && !showForm && suppliers.length > 0" class="pagination">
        <button class="btn-pagination" (click)="previousPage()" [disabled]="currentPage === 1">
            <i class="fas fa-chevron-left"></i>
        </button>
        <span class="page-info">
            {{ 'COMMON.PAGE' | translate }} {{ currentPage }} {{ 'COMMON.OF' | translate }} {{ totalPages }}
        </span>
        <button class="btn-pagination" (click)="nextPage()" [disabled]="currentPage >= totalPages">
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>
</div>