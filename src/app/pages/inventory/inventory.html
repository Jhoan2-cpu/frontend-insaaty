<div class="min-h-screen bg-gray-50 animate__animated animate__fadeIn">
    <!-- Breadcrumb -->
    <div class="bg-white border-b border-gray-200 px-4 sm:px-6 lg:px-8 py-3">
        <nav class="flex text-sm text-gray-500">
            <a routerLink="/dashboard" class="hover:text-blue-600 transition-colors">Dashboard</a>
            <span class="mx-2">/</span>
            <span class="text-gray-900 font-semibold">{{ 'INVENTORY.BREADCRUMB' | translate }}</span>
        </nav>
    </div>

    <div class="p-4 sm:p-6 lg:p-8">
        <div class="max-w-7xl mx-auto space-y-6">

            <!-- Header -->
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">{{ 'INVENTORY.TITLE' | translate }}</h1>
                    <p class="mt-2 text-sm text-gray-600">{{ 'INVENTORY.DESCRIPTION' | translate }}</p>
                </div>
                <div>
                    <button (click)="toggleProductForm()" [class.bg-gray-600]="showProductForm"
                        [class.bg-blue-600]="!showProductForm"
                        class="inline-flex items-center gap-2 px-4 py-2.5 text-white rounded-lg hover:bg-blue-700 transition-all shadow-sm hover:shadow-md font-medium">
                        <i [class.fa-times]="showProductForm" [class.fa-plus]="!showProductForm" class="fas"></i>
                        <span *ngIf="!showProductForm">{{ 'INVENTORY.NEW_PRODUCT' | translate }}</span>
                        <span *ngIf="showProductForm">{{ 'PRODUCT_MODAL.CANCEL' | translate }}</span>
                    </button>
                </div>
            </div>

            <!-- Products List -->

            <!-- Product Form (Accordion) -->
            @if (showProductForm) {
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6 animate__animated animate__fadeIn">
                <h2 class="text-xl font-bold text-gray-900 mb-4">
                    {{ isEditMode ? ('PRODUCT_MODAL.TITLE_EDIT' | translate) : ('PRODUCT_MODAL.TITLE_NEW' | translate)
                    }}
                </h2>

                <form [formGroup]="productForm" (ngSubmit)="saveProduct()" class="space-y-4">
                    <!-- Row 1: SKU, Name, Supplier -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">
                                {{ 'PRODUCT_MODAL.SKU' | translate }} *
                            </label>
                            <input type="text" formControlName="sku" [readonly]="isEditMode"
                                [class.bg-gray-50]="isEditMode"
                                class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                [class.border-red-500]="productForm.get('sku')?.invalid && productForm.get('sku')?.touched"
                                placeholder="PRD-001">
                            @if (productForm.get('sku')?.invalid && productForm.get('sku')?.touched) {
                            <p class="text-red-600 text-xs mt-1">{{ 'PRODUCT_MODAL.VALIDATION.SKU_REQUIRED' | translate
                                }}</p>
                            }
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">
                                {{ 'PRODUCT_MODAL.NAME' | translate }} *
                            </label>
                            <input type="text" formControlName="name"
                                class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                [class.border-red-500]="productForm.get('name')?.invalid && productForm.get('name')?.touched"
                                placeholder="Wireless Mouse">
                            @if (productForm.get('name')?.invalid && productForm.get('name')?.touched) {
                            <p class="text-red-600 text-xs mt-1">{{ 'PRODUCT_MODAL.VALIDATION.NAME_REQUIRED' | translate
                                }}</p>
                            }
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">
                                {{ 'SUPPLIERS.LABEL' | translate }}
                            </label>
                            <div class="flex gap-2">
                                <select formControlName="supplier_id"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option [ngValue]="null">-- {{ 'COMMON.NONE' | translate }} --</option>
                                    <option *ngFor="let supplier of suppliers" [value]="supplier.id">
                                        {{ supplier.name }}
                                    </option>
                                </select>
                                <button type="button" (click)="openSupplierModal()"
                                    class="px-3 py-2 bg-gray-100 border border-gray-300 rounded-lg hover:bg-gray-200 text-gray-600 transition-colors"
                                    title="{{ 'SUPPLIERS.NEW_SUPPLIER' | translate }}">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Description -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1.5">
                            {{ 'PRODUCT_MODAL.DESCRIPTION' | translate }}
                        </label>
                        <textarea formControlName="description" rows="2"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="Ergonomic wireless mouse with USB receiver"></textarea>
                    </div>

                    <!-- Row 2: Prices & Margin -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">
                                {{ 'PRODUCT_MODAL.PRICE_COST' | translate }} *
                            </label>
                            <div class="relative">
                                <span class="absolute left-3 top-2.5 text-gray-500">$</span>
                                <input type="number" formControlName="price_cost" step="0.01"
                                    class="w-full pl-7 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    [class.border-red-500]="productForm.get('price_cost')?.invalid && productForm.get('price_cost')?.touched">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">
                                {{ 'PRODUCT_MODAL.PRICE_SALE' | translate }} *
                            </label>
                            <div class="relative">
                                <span class="absolute left-3 top-2.5 text-gray-500">$</span>
                                <input type="number" formControlName="price_sale" step="0.01"
                                    class="w-full pl-7 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    [class.border-red-500]="productForm.get('price_sale')?.invalid && productForm.get('price_sale')?.touched">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">
                                {{ 'PRODUCT_MODAL.MARGIN' | translate }}
                            </label>
                            <div
                                class="px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg text-gray-700 font-semibold">
                                {{ margin.toFixed(1) }}%
                            </div>
                        </div>
                    </div>

                    <!-- Row 3: Stock -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">
                                {{ 'PRODUCT_MODAL.MIN_STOCK' | translate }}
                            </label>
                            <input type="number" formControlName="min_stock"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1.5">
                                {{ 'PRODUCT_MODAL.CURRENT_STOCK' | translate }} *
                            </label>
                            <input type="number" formControlName="current_stock"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg"
                                [class.bg-gray-50]="isEditMode">
                            @if (isEditMode) {
                            <p class="text-gray-500 text-xs mt-1">{{ 'PRODUCT_MODAL.STOCK_READONLY' | translate }}</p>
                            }
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="flex items-center gap-3 pt-4 border-t border-gray-200">
                        <button type="button" (click)="toggleProductForm()" [disabled]="isSaving"
                            class="flex-1 px-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium disabled:opacity-50">
                            {{ 'PRODUCT_MODAL.CANCEL' | translate }}
                        </button>
                        <button type="submit" [disabled]="isSaving || productForm.invalid"
                            class="flex-1 px-4 py-2.5 text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                            @if (isSaving) {
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>{{ 'PRODUCT_MODAL.SAVING' | translate }}</span>
                            } @else {
                            <i class="fas fa-save"></i>
                            <span>{{ 'PRODUCT_MODAL.SAVE' | translate }}</span>
                            }
                        </button>
                    </div>
                </form>
            </div>
            }

            <!-- Filters & Search -->
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6">
                <div class="flex flex-col lg:flex-row gap-4 justify-between">
                    <!-- Tabs -->
                    <div class="flex gap-2 flex-wrap">
                        <button *ngFor="let filter of filters" (click)="setFilter(filter.value)"
                            [class.bg-blue-50]="currentFilter === filter.value"
                            [class.text-blue-600]="currentFilter === filter.value"
                            [class.font-semibold]="currentFilter === filter.value"
                            [class.text-gray-600]="currentFilter !== filter.value"
                            class="px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                            {{ filter.label | translate }}
                        </button>
                    </div>

                    <!-- Search -->
                    <div class="relative max-w-md">
                        <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()"
                            [placeholder]="'INVENTORY.SEARCH_PLACEHOLDER' | translate"
                            class="w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    </div>
                </div>
            </div>

            <!-- Table -->
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th
                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.SKU' | translate }}
                                </th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.NAME' | translate }}
                                </th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.STOCK' | translate }}
                                </th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.COST_PRICE' | translate }}
                                </th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.SALE_PRICE' | translate }}
                                </th>
                                <th
                                    class="px-6 py-4 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.ACTIONS' | translate }}
                                </th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            @if (isLoading) {
                            <tr>
                                <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                                    <i class="fas fa-spinner fa-spin text-2xl text-blue-500"></i>
                                    <p class="mt-2">{{ 'INVENTORY.LOADING' | translate }}</p>
                                </td>
                            </tr>
                            } @else if (products.length === 0) {
                            <tr>
                                <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                                    <i class="fas fa-box-open text-4xl text-gray-300"></i>
                                    <p class="mt-2 font-medium">{{ 'INVENTORY.NO_PRODUCTS' | translate }}</p>
                                </td>
                            </tr>
                            } @else {
                            @for (product of products; track product.id) {
                            <tr class="hover:bg-gray-50 transition-colors animate__animated animate__fadeIn">
                                <td class="px-6 py-4 text-sm font-medium text-gray-900">{{product.sku}}</td>
                                <td class="px-6 py-4">
                                    <div class="flex items-center gap-3">
                                        <div
                                            class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-sm">
                                            {{product.name.charAt(0).toUpperCase()}}
                                        </div>
                                        <div>
                                            <p class="text-sm font-semibold text-gray-900">{{product.name}}</p>
                                            <p class="text-xs text-gray-500">{{product.description || 'Electronics >
                                                Peripherals'}}</p>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <span
                                        class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-bold"
                                        [class.bg-red-50]="product.current_stock <= 0"
                                        [class.text-red-600]="product.current_stock <= 0"
                                        [class.bg-yellow-50]="product.current_stock > 0 && product.current_stock < product.min_stock"
                                        [class.text-yellow-700]="product.current_stock > 0 && product.current_stock < product.min_stock"
                                        [class.bg-green-50]="product.current_stock >= product.min_stock"
                                        [class.text-green-600]="product.current_stock >= product.min_stock">
                                        <i class="fas fa-circle text-[6px]"></i>
                                        {{product.current_stock}}
                                        @if (product.current_stock <= 0) { ({{ 'INVENTORY.OUT_OF_STOCK_LABEL' |
                                            translate }}) } @else if (product.current_stock < product.min_stock) {
                                            ({{ 'INVENTORY.LOW_STOCK_LABEL' | translate }}) } </span>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-900">${{product.price_cost.toFixed(2)}}
                                </td>
                                <td class="px-6 py-4 text-sm font-bold text-gray-900">
                                    ${{product.price_sale.toFixed(2)}}
                                </td>
                                <td class="px-6 py-4 text-right relative">
                                    <button (click)="toggleMenu(product.id, $event)"
                                        class="text-gray-400 hover:text-gray-600 p-2 rounded-lg hover:bg-gray-100 transition-colors">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>

                                    <!-- Dropdown Menu -->
                                    @if (openMenuId === product.id) {
                                    <div
                                        class="absolute right-8 top-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-10">
                                        <div class="py-1">
                                            <button (click)="editProduct(product.id)"
                                                class="w-full flex items-center gap-3 px-4 py-2.5 text-left text-sm text-gray-700 hover:bg-gray-50 transition-colors">
                                                <i class="fas fa-edit text-blue-600 w-4"></i>
                                                <span>{{ 'INVENTORY.ACTIONS.EDIT' | translate }}</span>
                                            </button>
                                            <hr class="border-gray-100">
                                            <button (click)="deleteProduct(product.id)"
                                                class="w-full flex items-center gap-3 px-4 py-2.5 text-left text-sm text-red-600 hover:bg-red-50 transition-colors">
                                                <i class="fas fa-trash w-4"></i>
                                                <span>{{ 'INVENTORY.ACTIONS.DELETE' | translate }}</span>
                                            </button>
                                        </div>
                                    </div>
                                    }
                                </td>
                            </tr>
                            }
                            }
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                @if (!isLoading && products.length > 0) {
                <div
                    class="px-6 py-4 border-t border-gray-200 flex flex-col sm:flex-row items-center justify-between gap-4">
                    <span class="text-sm text-gray-500">
                        {{ 'INVENTORY.SHOWING' | translate }} {{((currentPage - 1) * pageSize) + 1}} {{ 'INVENTORY.TO' |
                        translate }} {{Math.min(currentPage * pageSize, totalProducts)}} {{ 'INVENTORY.OF' | translate
                        }} {{totalProducts}} {{ 'INVENTORY.RESULTS' | translate }}
                    </span>
                    <div class="flex gap-2">
                        <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1"
                            [class.opacity-50]="currentPage === 1" [class.cursor-not-allowed]="currentPage === 1"
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:hover:bg-white">
                            {{ 'INVENTORY.PREVIOUS' | translate }}
                        </button>

                        @for (page of getPaginationPages(); track page) {
                        @if (page === '...') {
                        <span class="px-4 py-2 text-gray-500">...</span>
                        } @else {
                        <button (click)="goToPage(+page)" [class.bg-blue-600]="currentPage === page"
                            [class.text-white]="currentPage === page" [class.bg-white]="currentPage !== page"
                            [class.text-gray-700]="currentPage !== page"
                            class="px-4 py-2 text-sm font-medium border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            {{page}}
                        </button>
                        }
                        }

                        <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages"
                            [class.opacity-50]="currentPage === totalPages"
                            [class.cursor-not-allowed]="currentPage === totalPages"
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:hover:bg-white">
                            {{ 'INVENTORY.NEXT' | translate }}
                        </button>
                    </div>
                </div>
                }
            </div>
        </div>

        <!-- Quick Supplier Modal -->
        @if (showSupplierModal) {
        <div class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
                <!-- Background overlay -->
                <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" (click)="closeSupplierModal()">
                </div>

                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

                <div
                    class="relative inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full animate__animated animate__zoomIn">
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div
                                class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10">
                                <i class="fas fa-truck text-blue-600"></i>
                            </div>
                            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                                <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                                    {{ 'SUPPLIERS.NEW_SUPPLIER' | translate }}
                                </h3>
                                <div class="mt-4">
                                    <form [formGroup]="supplierForm" class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                                {{ 'SUPPLIERS.NAME' | translate }} *
                                            </label>
                                            <input type="text" formControlName="name"
                                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                            @if (supplierForm.get('name')?.invalid && supplierForm.get('name')?.touched)
                                            {
                                            <p class="text-red-500 text-xs mt-1">{{
                                                'PRODUCT_MODAL.VALIDATION.NAME_REQUIRED' |
                                                translate }}</p>
                                            }
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">
                                                {{ 'SUPPLIERS.CONTACT_PERSON' | translate }}
                                            </label>
                                            <input type="text" formControlName="contact_person"
                                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                        </div>
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                                    {{ 'SUPPLIERS.EMAIL' | translate }}
                                                </label>
                                                <input type="email" formControlName="email"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                                    {{ 'SUPPLIERS.PHONE' | translate }}
                                                </label>
                                                <input type="text" formControlName="phone"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                        <button type="button" (click)="saveQuickSupplier()"
                            [disabled]="isSavingSupplier || supplierForm.invalid"
                            class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50">
                            @if (isSavingSupplier) { <i class="fas fa-spinner fa-spin mr-2"></i> }
                            {{ 'PRODUCT_MODAL.SAVE' | translate }}
                        </button>
                        <button type="button" (click)="closeSupplierModal()" [disabled]="isSavingSupplier"
                            class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                            {{ 'PRODUCT_MODAL.CANCEL' | translate }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
        }