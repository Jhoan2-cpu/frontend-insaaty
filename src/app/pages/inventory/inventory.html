<div class="min-h-screen bg-gray-50 animate__animated animate__fadeIn">
    <!-- Breadcrumb -->
    <div class="bg-white border-b border-gray-200 px-4 sm:px-6 lg:px-8 py-3">
        <nav class="flex text-sm text-gray-500">
            <a routerLink="/dashboard" class="hover:text-blue-600 transition-colors">Dashboard</a>
            <span class="mx-2">/</span>
            <span class="text-gray-900 font-semibold">{{ 'INVENTORY.BREADCRUMB' | translate }}</span>
        </nav>
    </div>

    <div class="p-4 sm:p-6 lg:p-8">
        <div class="max-w-7xl mx-auto space-y-6">

            <!-- Header -->
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div>
                    <p class="mt-2 text-sm text-gray-600">{{ 'INVENTORY.DESCRIPTION' | translate }}</p>
                </div>
                <div>
                    <button (click)="toggleProductForm()" [class.bg-gray-600]="showProductForm"
                        [class.bg-blue-600]="!showProductForm"
                        class="inline-flex items-center gap-2 px-4 py-2.5 text-white rounded-lg hover:bg-blue-700 transition-all shadow-sm hover:shadow-md font-medium">
                        <i [class.fa-times]="showProductForm" [class.fa-plus]="!showProductForm" class="fas"></i>
                        <span *ngIf="!showProductForm">{{ 'INVENTORY.NEW_PRODUCT' | translate }}</span>
                        <span *ngIf="showProductForm">{{ 'PRODUCT_MODAL.CANCEL' | translate }}</span>
                    </button>
                </div>
            </div>

            <!-- Products List -->

            <!-- Product Form (Accordion) -->
            @if (showProductForm) {
            <div class="bg-white rounded-xl shadow-lg border border-gray-300 p-8 animate__animated animate__fadeIn">
                <h2 class="text-2xl font-bold text-gray-900 mb-8 flex items-center">
                    <span class="w-1.5 h-8 bg-emerald-500 rounded-full mr-3"></span>
                    {{ isEditMode ? ('PRODUCT_MODAL.TITLE_EDIT' | translate) : ('PRODUCT_MODAL.TITLE_NEW' | translate)
                    }}
                </h2>

                <form [formGroup]="productForm" (ngSubmit)="saveProduct()" class="space-y-8">
                    <!-- Row 1: SKU, Name, Supplier -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="space-y-2">
                            <label class="block text-sm font-bold text-gray-700">
                                {{ 'PRODUCT_MODAL.SKU' | translate }} <span class="text-red-500">*</span>
                            </label>
                            <input type="text" formControlName="sku" [readonly]="isEditMode"
                                [class.bg-gray-50]="isEditMode"
                                class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all"
                                [class.border-red-300]="productForm.get('sku')?.invalid && productForm.get('sku')?.touched"
                                placeholder="PRD-001">
                            @if (productForm.get('sku')?.invalid && productForm.get('sku')?.touched) {
                            <p class="text-red-500 text-xs font-medium">{{ 'PRODUCT_MODAL.VALIDATION.SKU_REQUIRED' |
                                translate
                                }}</p>
                            }
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-bold text-gray-700">
                                {{ 'PRODUCT_MODAL.NAME' | translate }} <span class="text-red-500">*</span>
                            </label>
                            <input type="text" formControlName="name"
                                class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all"
                                [class.border-red-300]="productForm.get('name')?.invalid && productForm.get('name')?.touched"
                                placeholder="Wireless Mouse">
                            @if (productForm.get('name')?.invalid && productForm.get('name')?.touched) {
                            <p class="text-red-500 text-xs font-medium">{{ 'PRODUCT_MODAL.VALIDATION.NAME_REQUIRED' |
                                translate
                                }}</p>
                            }
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-bold text-gray-700">
                                {{ 'SUPPLIERS.LABEL' | translate }}
                            </label>
                            <div class="flex gap-2">
                                <select formControlName="supplier_id"
                                    class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg text-gray-900 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all appearance-none">
                                    <option [ngValue]="null">-- {{ 'COMMON.NONE' | translate }} --</option>
                                    <option *ngFor="let supplier of suppliers" [value]="supplier.id">
                                        {{ supplier.name }}
                                    </option>
                                </select>
                                <a routerLink="/suppliers" [queryParams]="{ action: 'create' }"
                                    class="px-4 py-3 bg-emerald-50 text-emerald-600 rounded-lg hover:bg-emerald-100 transition-colors flex items-center justify-center min-w-[3rem]"
                                    title="{{ 'SUPPLIERS.NEW_SUPPLIER' | translate }}">
                                    <i class="fas fa-plus"></i>
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="space-y-2">
                        <label class="block text-sm font-bold text-gray-700">
                            {{ 'PRODUCT_MODAL.DESCRIPTION' | translate }}
                        </label>
                        <textarea formControlName="description" rows="3"
                            class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all resize-none"
                            placeholder="Ergonomic wireless mouse with USB receiver..."></textarea>
                    </div>

                    <!-- Row 2: Prices & Margin -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="space-y-2">
                            <label class="block text-sm font-bold text-gray-700">
                                {{ 'PRODUCT_MODAL.PRICE_COST' | translate }} <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <span class="absolute left-4 top-3.5 text-gray-400">$</span>
                                <input type="number" formControlName="price_cost" step="0.01"
                                    class="w-full pl-8 pr-4 py-3 bg-white border border-gray-200 rounded-lg text-gray-900 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all"
                                    [class.border-red-300]="productForm.get('price_cost')?.invalid && productForm.get('price_cost')?.touched">
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-bold text-gray-700">
                                {{ 'PRODUCT_MODAL.PRICE_SALE' | translate }} <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <span class="absolute left-4 top-3.5 text-gray-400">$</span>
                                <input type="number" formControlName="price_sale" step="0.01"
                                    class="w-full pl-8 pr-4 py-3 bg-white border border-gray-200 rounded-lg text-gray-900 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all"
                                    [class.border-red-300]="productForm.get('price_sale')?.invalid && productForm.get('price_sale')?.touched">
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-bold text-gray-700">
                                {{ 'PRODUCT_MODAL.MARGIN' | translate }}
                            </label>
                            <div
                                class="w-full px-4 py-3 bg-emerald-50 border border-emerald-100 rounded-lg text-emerald-700 font-bold flex items-center justify-between">
                                <span>{{ margin.toFixed(1) }}%</span>
                                <i class="fas fa-check-circle text-emerald-500"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Row 3: Stock -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-2">
                            <label class="block text-sm font-bold text-gray-700">
                                {{ 'PRODUCT_MODAL.MIN_STOCK' | translate }}
                            </label>
                            <input type="number" formControlName="min_stock"
                                class="w-full px-4 py-3 bg-white border border-gray-200 rounded-lg text-gray-900 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-bold text-gray-700 flex items-center justify-between">
                                <span>{{ 'PRODUCT_MODAL.CURRENT_STOCK' | translate }} <span
                                        class="text-red-500">*</span></span>
                                @if (isEditMode) {
                                <i class="fas fa-info-circle text-gray-400"
                                    title="{{ 'PRODUCT_MODAL.STOCK_READONLY' | translate }}"></i>
                                }
                            </label>
                            <input type="number" formControlName="current_stock"
                                class="w-full px-4 py-3 border border-gray-200 rounded-lg text-gray-900 bg-white"
                                [class.bg-gray-50]="isEditMode" [class.text-gray-500]="isEditMode">

                            @if (isEditMode) {
                            <div class="mt-2 bg-amber-50 border border-amber-200 rounded-md p-3 flex items-start gap-2">
                                <i class="fas fa-exclamation-circle text-amber-500 mt-0.5 text-xs"></i>
                                <p class="text-xs text-amber-700 font-medium leading-relaxed">{{
                                    'PRODUCT_MODAL.STOCK_READONLY' | translate }}</p>
                            </div>
                            }
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="flex items-center gap-4 pt-8 border-t border-gray-100">
                        <button type="button" (click)="toggleProductForm()" [disabled]="isSaving"
                            class="w-full sm:w-auto px-8 py-3.5 text-gray-700 bg-white border border-gray-200 rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all font-bold text-sm shadow-sm disabled:opacity-50">
                            {{ 'PRODUCT_MODAL.CANCEL' | translate }}
                        </button>
                        <button type="submit" [disabled]="isSaving || productForm.invalid"
                            class="w-full sm:w-auto flex-1 px-8 py-3.5 text-white bg-emerald-500 rounded-xl hover:bg-emerald-600 shadow-lg shadow-emerald-500/30 transition-all font-bold text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none">
                            @if (isSaving) {
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>{{ 'PRODUCT_MODAL.SAVING' | translate }}</span>
                            } @else {
                            <i class="fas fa-save"></i>
                            <span>{{ 'PRODUCT_MODAL.SAVE' | translate }}</span>
                            }
                        </button>
                    </div>
                </form>
            </div>
            }

            <!-- Filters & Search -->
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6">
                <div class="flex flex-col lg:flex-row gap-4 justify-between">
                    <!-- Tabs -->
                    <div class="flex gap-2 flex-wrap">
                        <button *ngFor="let filter of filters" (click)="setFilter(filter.value)"
                            [class.bg-blue-50]="currentFilter === filter.value"
                            [class.text-blue-600]="currentFilter === filter.value"
                            [class.font-semibold]="currentFilter === filter.value"
                            [class.text-gray-600]="currentFilter !== filter.value"
                            class="px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                            {{ filter.label | translate }}
                        </button>
                    </div>

                    <!-- Search -->
                    <div class="relative max-w-md">
                        <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()"
                            [placeholder]="'INVENTORY.SEARCH_PLACEHOLDER' | translate"
                            class="w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    </div>
                </div>
            </div>

            <!-- Table -->
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th
                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.SKU' | translate }}
                                </th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.NAME' | translate }}
                                </th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.STOCK' | translate }}
                                </th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.COST_PRICE' | translate }}
                                </th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.SALE_PRICE' | translate }}
                                </th>
                                <th
                                    class="px-6 py-4 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.ACTIONS' | translate }}
                                </th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            @if (isLoading) {
                            <tr>
                                <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                                    <i class="fas fa-spinner fa-spin text-2xl text-blue-500"></i>
                                    <p class="mt-2">{{ 'INVENTORY.LOADING' | translate }}</p>
                                </td>
                            </tr>
                            } @else if (products.length === 0) {
                            <tr>
                                <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                                    <i class="fas fa-box-open text-4xl text-gray-300"></i>
                                    <p class="mt-2 font-medium">{{ 'INVENTORY.NO_PRODUCTS' | translate }}</p>
                                </td>
                            </tr>
                            } @else {
                            @for (product of products; track product.id) {
                            <tr class="hover:bg-gray-50 transition-colors animate__animated animate__fadeIn">
                                <td class="px-6 py-4 text-sm font-medium text-gray-900">{{product.sku}}</td>
                                <td class="px-6 py-4">
                                    <div class="flex items-center gap-3">
                                        <div
                                            class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-sm">
                                            {{product.name.charAt(0).toUpperCase()}}
                                        </div>
                                        <div>
                                            <p class="text-sm font-semibold text-gray-900">{{product.name}}</p>
                                            <p class="text-xs text-gray-500">{{product.description || 'Electronics >
                                                Peripherals'}}</p>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <span
                                        class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-bold"
                                        [class.bg-red-50]="product.current_stock <= 0"
                                        [class.text-red-600]="product.current_stock <= 0"
                                        [class.bg-yellow-50]="product.current_stock > 0 && product.current_stock < product.min_stock"
                                        [class.text-yellow-700]="product.current_stock > 0 && product.current_stock < product.min_stock"
                                        [class.bg-green-50]="product.current_stock >= product.min_stock"
                                        [class.text-green-600]="product.current_stock >= product.min_stock">
                                        <i class="fas fa-circle text-[6px]"></i>
                                        {{product.current_stock}}
                                        @if (product.current_stock <= 0) { ({{ 'INVENTORY.OUT_OF_STOCK_LABEL' |
                                            translate }}) } @else if (product.current_stock < product.min_stock) {
                                            ({{ 'INVENTORY.LOW_STOCK_LABEL' | translate }}) } </span>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-900">${{product.price_cost.toFixed(2)}}
                                </td>
                                <td class="px-6 py-4 text-sm font-bold text-gray-900">
                                    ${{product.price_sale.toFixed(2)}}
                                </td>
                                <td class="px-6 py-4 text-right relative">
                                    <button (click)="toggleMenu(product.id, $event)"
                                        class="text-gray-400 hover:text-gray-600 p-2 rounded-lg hover:bg-gray-100 transition-colors">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>

                                    <!-- Dropdown Menu -->
                                    @if (openMenuId === product.id) {
                                    <div
                                        class="absolute right-8 top-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-10">
                                        <div class="py-1">
                                            <button (click)="editProduct(product.id)"
                                                class="w-full flex items-center gap-3 px-4 py-2.5 text-left text-sm text-gray-700 hover:bg-gray-50 transition-colors">
                                                <i class="fas fa-edit text-blue-600 w-4"></i>
                                                <span>{{ 'INVENTORY.ACTIONS.EDIT' | translate }}</span>
                                            </button>
                                            <hr class="border-gray-100">
                                            <button (click)="deleteProduct(product.id)"
                                                class="w-full flex items-center gap-3 px-4 py-2.5 text-left text-sm text-red-600 hover:bg-red-50 transition-colors">
                                                <i class="fas fa-trash w-4"></i>
                                                <span>{{ 'INVENTORY.ACTIONS.DELETE' | translate }}</span>
                                            </button>
                                        </div>
                                    </div>
                                    }
                                </td>
                            </tr>
                            }
                            }
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                @if (!isLoading && products.length > 0) {
                <div
                    class="px-6 py-4 border-t border-gray-200 flex flex-col sm:flex-row items-center justify-between gap-4">
                    <span class="text-sm text-gray-500">
                        {{ 'INVENTORY.SHOWING' | translate }} {{((currentPage - 1) * pageSize) + 1}} {{ 'INVENTORY.TO' |
                        translate }} {{Math.min(currentPage * pageSize, totalProducts)}} {{ 'INVENTORY.OF' | translate
                        }} {{totalProducts}} {{ 'INVENTORY.RESULTS' | translate }}
                    </span>
                    <div class="flex gap-2">
                        <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1"
                            [class.opacity-50]="currentPage === 1" [class.cursor-not-allowed]="currentPage === 1"
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:hover:bg-white">
                            {{ 'INVENTORY.PREVIOUS' | translate }}
                        </button>

                        @for (page of getPaginationPages(); track page) {
                        @if (page === '...') {
                        <span class="px-4 py-2 text-gray-500">...</span>
                        } @else {
                        <button (click)="goToPage(+page)" [class.bg-blue-600]="currentPage === page"
                            [class.text-white]="currentPage === page" [class.bg-white]="currentPage !== page"
                            [class.text-gray-700]="currentPage !== page"
                            class="px-4 py-2 text-sm font-medium border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            {{page}}
                        </button>
                        }
                        }

                        <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages"
                            [class.opacity-50]="currentPage === totalPages"
                            [class.cursor-not-allowed]="currentPage === totalPages"
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:hover:bg-white">
                            {{ 'INVENTORY.NEXT' | translate }}
                        </button>
                    </div>
                </div>
                }
            </div>
        </div>