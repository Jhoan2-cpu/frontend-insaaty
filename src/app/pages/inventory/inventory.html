<div class="min-h-screen bg-gray-50 animate__animated animate__fadeIn">
    <!-- Breadcrumb -->
    <div class="bg-white border-b border-gray-200 px-4 sm:px-6 lg:px-8 py-3">
        <nav class="flex text-sm text-gray-500">
            <a routerLink="/dashboard" class="hover:text-blue-600 transition-colors">Dashboard</a>
            <span class="mx-2">/</span>
            <span class="text-gray-900 font-semibold">{{ 'INVENTORY.BREADCRUMB' | translate }}</span>
        </nav>
    </div>

    <div class="p-4 sm:p-6 lg:p-8">
        <div class="max-w-7xl mx-auto space-y-6">

            <!-- Header -->
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">{{ 'INVENTORY.TITLE' | translate }}</h1>
                    <p class="mt-2 text-sm text-gray-600">{{ 'INVENTORY.DESCRIPTION' | translate }}</p>
                </div>
                <div>
                    <button (click)="openNewProductModal()"
                        class="inline-flex items-center gap-2 px-4 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all shadow-sm hover:shadow-md font-medium">
                        <i class="fas fa-plus"></i>
                        <span>{{ 'INVENTORY.NEW_PRODUCT' | translate }}</span>
                    </button>
                </div>
            </div>

            <!-- Filters & Search -->
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6">
                <div class="flex flex-col lg:flex-row gap-4 justify-between">
                    <!-- Tabs -->
                    <div class="flex gap-2 flex-wrap">
                        <button *ngFor="let filter of filters" (click)="setFilter(filter.value)"
                            [class.bg-blue-50]="currentFilter === filter.value"
                            [class.text-blue-600]="currentFilter === filter.value"
                            [class.font-semibold]="currentFilter === filter.value"
                            [class.text-gray-600]="currentFilter !== filter.value"
                            class="px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                            {{ filter.label | translate }}
                        </button>
                    </div>

                    <!-- Search -->
                    <div class="relative max-w-md">
                        <input type="text" [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()"
                            [placeholder]="'INVENTORY.SEARCH_PLACEHOLDER' | translate"
                            class="w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    </div>
                </div>
            </div>

            <!-- Table -->
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th
                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.SKU' | translate }}
                                </th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.NAME' | translate }}
                                </th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.STOCK' | translate }}
                                </th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.COST_PRICE' | translate }}
                                </th>
                                <th
                                    class="px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.SALE_PRICE' | translate }}
                                </th>
                                <th
                                    class="px-6 py-4 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">
                                    {{ 'INVENTORY.ACTIONS' | translate }}
                                </th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            @if (isLoading) {
                            <tr>
                                <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                                    <i class="fas fa-spinner fa-spin text-2xl text-blue-500"></i>
                                    <p class="mt-2">{{ 'INVENTORY.LOADING' | translate }}</p>
                                </td>
                            </tr>
                            } @else if (products.length === 0) {
                            <tr>
                                <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                                    <i class="fas fa-box-open text-4xl text-gray-300"></i>
                                    <p class="mt-2 font-medium">{{ 'INVENTORY.NO_PRODUCTS' | translate }}</p>
                                </td>
                            </tr>
                            } @else {
                            @for (product of products; track product.id) {
                            <tr class="hover:bg-gray-50 transition-colors animate__animated animate__fadeIn">
                                <td class="px-6 py-4 text-sm font-medium text-gray-900">{{product.sku}}</td>
                                <td class="px-6 py-4">
                                    <div class="flex items-center gap-3">
                                        <div
                                            class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-sm">
                                            {{product.name.charAt(0).toUpperCase()}}
                                        </div>
                                        <div>
                                            <p class="text-sm font-semibold text-gray-900">{{product.name}}</p>
                                            <p class="text-xs text-gray-500">{{product.description || 'Electronics >
                                                Peripherals'}}</p>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <span
                                        class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-bold"
                                        [class.bg-red-50]="product.current_stock <= 0"
                                        [class.text-red-600]="product.current_stock <= 0"
                                        [class.bg-yellow-50]="product.current_stock > 0 && product.current_stock < product.min_stock"
                                        [class.text-yellow-700]="product.current_stock > 0 && product.current_stock < product.min_stock"
                                        [class.bg-green-50]="product.current_stock >= product.min_stock"
                                        [class.text-green-600]="product.current_stock >= product.min_stock">
                                        <i class="fas fa-circle text-[6px]"></i>
                                        {{product.current_stock}}
                                        @if (product.current_stock <= 0) { ({{ 'INVENTORY.OUT_OF_STOCK_LABEL' |
                                            translate }}) } @else if (product.current_stock < product.min_stock) {
                                            ({{ 'INVENTORY.LOW_STOCK_LABEL' | translate }}) } </span>
                                </td>
                                <td class="px-6 py-4 text-sm text-gray-900">${{product.price_cost.toFixed(2)}}
                                </td>
                                <td class="px-6 py-4 text-sm font-bold text-gray-900">
                                    ${{product.price_sale.toFixed(2)}}
                                </td>
                                <td class="px-6 py-4 text-right relative">
                                    <button (click)="toggleMenu(product.id, $event)"
                                        class="text-gray-400 hover:text-gray-600 p-2 rounded-lg hover:bg-gray-100 transition-colors">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>

                                    <!-- Dropdown Menu -->
                                    @if (openMenuId === product.id) {
                                    <div
                                        class="absolute right-8 top-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-10">
                                        <div class="py-1">
                                            <button (click)="openEditProductModal(product.id)"
                                                class="w-full flex items-center gap-3 px-4 py-2.5 text-left text-sm text-gray-700 hover:bg-gray-50 transition-colors">
                                                <i class="fas fa-edit text-blue-600 w-4"></i>
                                                <span>{{ 'INVENTORY.ACTIONS.EDIT' | translate }}</span>
                                            </button>
                                            <hr class="border-gray-100">
                                            <button (click)="confirmDelete(product.id)"
                                                class="w-full flex items-center gap-3 px-4 py-2.5 text-left text-sm text-red-600 hover:bg-red-50 transition-colors">
                                                <i class="fas fa-trash w-4"></i>
                                                <span>{{ 'INVENTORY.ACTIONS.DELETE' | translate }}</span>
                                            </button>
                                        </div>
                                    </div>
                                    }
                                </td>
                            </tr>
                            }
                            }
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                @if (!isLoading && products.length > 0) {
                <div
                    class="px-6 py-4 border-t border-gray-200 flex flex-col sm:flex-row items-center justify-between gap-4">
                    <span class="text-sm text-gray-500">
                        {{ 'INVENTORY.SHOWING' | translate }} {{((currentPage - 1) * pageSize) + 1}} {{ 'INVENTORY.TO' |
                        translate }} {{Math.min(currentPage * pageSize, totalProducts)}} {{ 'INVENTORY.OF' | translate
                        }} {{totalProducts}} {{ 'INVENTORY.RESULTS' | translate }}
                    </span>
                    <div class="flex gap-2">
                        <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1"
                            [class.opacity-50]="currentPage === 1" [class.cursor-not-allowed]="currentPage === 1"
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:hover:bg-white">
                            {{ 'INVENTORY.PREVIOUS' | translate }}
                        </button>

                        @for (page of getPaginationPages(); track page) {
                        @if (page === '...') {
                        <span class="px-4 py-2 text-gray-500">...</span>
                        } @else {
                        <button (click)="goToPage(+page)" [class.bg-blue-600]="currentPage === page"
                            [class.text-white]="currentPage === page" [class.bg-white]="currentPage !== page"
                            [class.text-gray-700]="currentPage !== page"
                            class="px-4 py-2 text-sm font-medium border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            {{page}}
                        </button>
                        }
                        }

                        <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages"
                            [class.opacity-50]="currentPage === totalPages"
                            [class.cursor-not-allowed]="currentPage === totalPages"
                            class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:hover:bg-white">
                            {{ 'INVENTORY.NEXT' | translate }}
                        </button>
                    </div>
                </div>
                }
            </div>

        </div>
    </div>
</div>

<!-- Modal Nuevo/Editar Producto -->
<app-product-modal [isOpen]="isProductModalOpen" [productId]="selectedProductId" (close)="closeProductModal()"
    (saved)="onProductSaved($event)">
</app-product-modal>

<!-- Confirm Delete Dialog -->
<app-confirm-dialog [isOpen]="isConfirmDialogOpen" [title]="'CONFIRM_DIALOG.DELETE_PRODUCT_TITLE' | translate"
    [message]="'CONFIRM_DIALOG.DELETE_PRODUCT_MESSAGE' | translate" [confirmText]="'CONFIRM_DIALOG.DELETE' | translate"
    [cancelText]="'CONFIRM_DIALOG.CANCEL' | translate" [isLoading]="isDeletingProduct" (confirm)="executeDelete()"
    (cancel)="cancelDelete()">
</app-confirm-dialog>